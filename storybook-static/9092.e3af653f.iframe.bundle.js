(self.webpackChunk_webviz_subsurface_components=self.webpackChunk_webviz_subsurface_components||[]).push([[9092],{"./packages/subsurface-viewer/src/components/InfoCard.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_mui_material__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@mui/material/Table/Table.js"),_mui_material__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@mui/material/TableCell/TableCell.js"),_mui_material__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@mui/material/TableRow/TableRow.js"),_mui_material__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@mui/material/Collapse/Collapse.js"),_mui_material__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@mui/material/TableBody/TableBody.js"),_mui_material__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@mui/material/TableContainer/TableContainer.js"),_equinor_eds_core_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/subsurface-viewer/node_modules/@equinor/eds-core-react/dist/esm/components/Icon/index.js"),_equinor_eds_core_react__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./packages/subsurface-viewer/node_modules/@equinor/eds-core-react/dist/esm/components/Button/index.js"),_equinor_eds_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/subsurface-viewer/node_modules/@equinor/eds-icons/dist/esm/index.js"),_mui_system__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@mui/system/esm/styled.js"),d3_color__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/d3-color/src/color.js"),_layers_wells_layers_wellLabelLayer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/subsurface-viewer/src/layers/wells/layers/wellLabelLayer.ts"),_viewports_sectionViewport__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/subsurface-viewer/src/viewports/sectionViewport.ts");_equinor_eds_core_react__WEBPACK_IMPORTED_MODULE_4__.I.add({arrow_drop_up:_equinor_eds_icons__WEBPACK_IMPORTED_MODULE_1__.u7t,arrow_drop_down:_equinor_eds_icons__WEBPACK_IMPORTED_MODULE_1__.FxC});const StyledTable=(0,_mui_system__WEBPACK_IMPORTED_MODULE_5__.A)(_mui_material__WEBPACK_IMPORTED_MODULE_6__.A)({"& > *":{backgroundColor:"#ffffffcc",color:"#000000ff",border:"2px solid #ccc",padding:"0px",borderRadius:"5px",position:"absolute",bottom:0,left:0,marginLeft:"3px",marginBottom:"3px"}}),StyledTableCell=(0,_mui_system__WEBPACK_IMPORTED_MODULE_5__.A)(_mui_material__WEBPACK_IMPORTED_MODULE_7__.A)({border:"none",padding:0,width:"20px"}),StyledTableRow=(0,_mui_system__WEBPACK_IMPORTED_MODULE_5__.A)(_mui_material__WEBPACK_IMPORTED_MODULE_8__.A)({"& > *":{padding:0}});function Row(props){const{layer_data:layer_data}=props,[open,setOpen]=react__WEBPACK_IMPORTED_MODULE_0__.useState(!0);return 0==layer_data.properties?.length?null:react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(StyledTableRow,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(StyledTableCell,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_equinor_eds_core_react__WEBPACK_IMPORTED_MODULE_9__.$,{style:{padding:0},variant:"ghost",onClick:()=>setOpen(!open)},open?react__WEBPACK_IMPORTED_MODULE_0__.createElement(_equinor_eds_core_react__WEBPACK_IMPORTED_MODULE_4__.I,{color:"currentColor",name:"arrow_drop_up"}):react__WEBPACK_IMPORTED_MODULE_0__.createElement(_equinor_eds_core_react__WEBPACK_IMPORTED_MODULE_4__.I,{color:"currentColor",name:"arrow_drop_down"}))),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_7__.A,null," ",layer_data.layerName," ")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(StyledTableRow,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_7__.A,{style:{paddingBottom:0,paddingTop:0},colSpan:2},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_10__.A,{in:open,timeout:"auto",unmountOnExit:!0},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_6__.A,{size:"small","aria-label":"properties"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_11__.A,null,layer_data.properties?.map((propertyRow=>{return react__WEBPACK_IMPORTED_MODULE_0__.createElement(StyledTableRow,{key:propertyRow.name},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_7__.A,{style:{border:"none",paddingLeft:10,paddingRight:10}},propertyRow.color&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{style:{color:(0,d3_color__WEBPACK_IMPORTED_MODULE_12__.Qh)(...propertyRow.color).toString()}},"â¬¤"),propertyRow.name),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_7__.A,{style:{border:"none",textAlign:"right"}},"number"==typeof propertyRow.value?(num=propertyRow.value,parseFloat(num.toExponential(Math.max(1,2+Math.log10(Math.abs(num)))))):propertyRow.value));var num}))))))))}const InfoCard=props=>{const[infoCardData,setInfoCardData]=react__WEBPACK_IMPORTED_MODULE_0__.useState(null);return react__WEBPACK_IMPORTED_MODULE_0__.useEffect((()=>{if(0===props.pickInfos.length)return void setInfoCardData(null);if((props.pickInfos[0].layer?.constructor===_layers_wells_layers_wellLabelLayer__WEBPACK_IMPORTED_MODULE_2__.U||props.pickInfos[0].sourceLayer?.constructor===_layers_wells_layers_wellLabelLayer__WEBPACK_IMPORTED_MODULE_2__.U)&&props.pickInfos[0].object?.wellLabels){const info_card_data=[],xy_properties=[];return props.pickInfos[0].object.wellLabels.forEach((label=>{xy_properties.push({name:label,value:""})})),info_card_data.push({layerName:"Well(s)",properties:xy_properties}),void setInfoCardData(info_card_data)}const topObject=props.pickInfos[0];if(void 0===topObject.coordinate||topObject.coordinate.length<2)return;const isSectionViewport=props.pickInfos[0].viewport instanceof _viewports_sectionViewport__WEBPACK_IMPORTED_MODULE_3__.c,xy_properties=[];xy_properties.push({name:isSectionViewport?"distance":"x",value:Number(topObject.coordinate[0]).toFixed(2).toString()+" m"}),xy_properties.push({name:isSectionViewport?"z":"y",value:Number(topObject.coordinate[1]).toFixed(2).toString()+" m"}),null==topObject.coordinate[2]||Number.isNaN(topObject.coordinate[2])||isSectionViewport||xy_properties.push({name:"z",value:Number(topObject.coordinate[2]).toFixed(2).toString()+" m"});const info_card_data=[];info_card_data.push({layerName:"Position",properties:xy_properties}),props.pickInfos.forEach((info=>{const layer_properties=info.properties,layer_name=info.layer?.props?.name,zValue=info.propertyValue;if(void 0!==zValue){const property=xy_properties.find((item=>item.name===layer_name));property?property.value=zValue:xy_properties.push({name:layer_name,value:zValue})}const layer=info_card_data.find((item=>item.layerName===layer_name));layer?layer_properties?.forEach((layer_prop=>{const property=layer.properties?.find((item=>item.name===layer_prop.name));property?property.value=layer_prop.value:layer.properties?.push(layer_prop)})):info_card_data.push({layerName:layer_name||"unknown-layer",properties:layer_properties})})),setInfoCardData(info_card_data)}),[props.pickInfos]),infoCardData&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_13__.A,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(StyledTable,{"aria-label":"info-card"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_11__.A,null,infoCardData.map((card_data=>card_data.properties&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(Row,{key:card_data.layerName,layer_data:card_data}))))))};__webpack_exports__.A=InfoCard,InfoCard.__docgenInfo={description:"",methods:[],displayName:"InfoCard",props:{pickInfos:{required:!0,tsType:{name:"Array",elements:[{name:"LayerPickInfo"}],raw:"LayerPickInfo[]"},description:"List of JSON object describing picking information of layers\nthat are under the cursor."}}}},"./packages/subsurface-viewer/src/extensions/fixed-size-extension.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{$:function(){return FixedSizeExtension}});var _deck_gl_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@deck.gl/core/dist/lib/layer-extension.js");class FixedSizeExtension extends _deck_gl_core__WEBPACK_IMPORTED_MODULE_0__.A{getShaders(){return{inject:{"vs:DECKGL_FILTER_SIZE":"size *= gl_Position.w;"}}}}},"./packages/subsurface-viewer/src/layers/utils/layerTools.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{M1:function(){return getWellLayerByTypeAndSelectedWells},T3:function(){return getLayersById},d8:function(){return getModelMatrixScale},e2:function(){return createPropertyData},eM:function(){return getFromAccessor},eo:function(){return getLayersByType},gU:function(){return isDrawingEnabled},pK:function(){return getModelMatrix},xt:function(){return computeBoundingBox}});var math_gl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@math.gl/core/dist/classes/matrix4.js"),_utils_BoundingBox3D__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/subsurface-viewer/src/utils/BoundingBox3D.ts");function createPropertyData(name,value,color){return{name:name,value:value,color:color}}function getModelMatrix(deg,x,y){const rad=.017453*deg,IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],m1=new math_gl__WEBPACK_IMPORTED_MODULE_0__.k(IDENTITY).translate([-x,-y,0,1]),mRot=new math_gl__WEBPACK_IMPORTED_MODULE_0__.k(IDENTITY).rotateZ(rad),m2=new math_gl__WEBPACK_IMPORTED_MODULE_0__.k(IDENTITY).translate([x,y,0,1]);mRot.multiplyRight(m1);return m2.multiplyRight(mRot)}function getModelMatrixScale(scaleZ){return new math_gl__WEBPACK_IMPORTED_MODULE_0__.k([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).scale([1,1,scaleZ])}function getLayersByType(layers,type){return layers?layers.filter((l=>l?.constructor.name===type)):[]}function getWellLayerByTypeAndSelectedWells(layers,type,selectedWell){return layers&&selectedWell?layers.filter((l=>l?.constructor.name===type&&l.props.data?.features?.find((item=>item.properties.name===selectedWell)))):[]}function getLayersById(layers,id){return layers?layers.filter((l=>l.id===id)):[]}function isDrawingEnabled(layer_manager){const drawing_layer=layer_manager.getLayers({layerIds:["drawing-layer"]})?.[0];return drawing_layer&&drawing_layer.props.visible&&"view"!=drawing_layer.props.mode}function computeBoundingBox(dataArray,zIncreasingDownwards=!1){const bbox=(0,_utils_BoundingBox3D__WEBPACK_IMPORTED_MODULE_1__.xt)(dataArray);return zIncreasingDownwards&&(bbox[2]=-bbox[2],bbox[5]=-bbox[5]),bbox}function getFromAccessor(accessor,data,objectInfo){return"function"!=typeof accessor?accessor:accessor(data,objectInfo)}},"./packages/subsurface-viewer/src/layers/wells/layers/mergedTextLayer.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{x:function(){return MergedTextLayer}});var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/lodash.js"),lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__),_deck_gl_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@deck.gl/core/dist/utils/iterable-utils.js"),_deck_gl_layers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@deck.gl/layers/dist/text-layer/text-layer.js"),static_kdtree__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/static-kdtree/kdtree.js"),static_kdtree__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(static_kdtree__WEBPACK_IMPORTED_MODULE_1__);const DEFAULT_PROPS={mergeRadius:100,mergeLabels:!0,getClusterText:texts=>texts.length>1?`${texts[0]} (+${texts.length-1})`:texts[0]};class MergedTextLayer extends _deck_gl_layers__WEBPACK_IMPORTED_MODULE_2__.A{static defaultProps=DEFAULT_PROPS;static layerName="MergedTextLayer";shouldUpdateState(params){return!!params.changeFlags.propsOrDataChanged||super.shouldUpdateState(params)}updateState(params){super.updateState(params),params.changeFlags.propsOrDataChanged&&(this.updateLabelPositions(),this.updateLabelClusters(),this.updateInstanceState(),this.setState({getText:lodash__WEBPACK_IMPORTED_MODULE_0___default().bind(this.getText,this)}))}getSubLayerProps(sublayerProps){const allUpdateTriggers=sublayerProps?.updateTriggers?.all??[],newProps={...sublayerProps,getColor:lodash__WEBPACK_IMPORTED_MODULE_0___default().bind(this.getColor,this),getFillColor:lodash__WEBPACK_IMPORTED_MODULE_0___default().bind(this.getBackgroundColor,this),getLineColor:lodash__WEBPACK_IMPORTED_MODULE_0___default().bind(this.getBorderColor,this),updateTriggers:{...sublayerProps?.updateTriggers,all:[...allUpdateTriggers,this.props.mergeRadius,this.props.mergeLabels,this.props.getPosition]}};return super.getSubLayerProps(newProps)}updateLabelPositions(){const{data:data,getText:getText}=this.props;let{getPosition:getPosition}=this.getSubLayerProps({...this.props});lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(getPosition)&&(getPosition=this.props.getPosition);const labelPositions=new Map,positionToText=new Map,{iterable:iterable,objectInfo:objectInfo}=(0,_deck_gl_core__WEBPACK_IMPORTED_MODULE_3__.X)(data);for(const object of iterable){const text=getText(object,objectInfo),position="function"==typeof getPosition?getPosition(object,objectInfo):getPosition;lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(position)||(labelPositions.set(text,position),positionToText.has(position)?positionToText.get(position)?.push(text):positionToText.set(position,[text]))}this.setState({labelPositions:labelPositions,positionToText:positionToText})}updateInstanceState(){const{data:data}=this.props;let numInstances=0;const startIndices=[0],{iterable:iterable,objectInfo:objectInfo}=(0,_deck_gl_core__WEBPACK_IMPORTED_MODULE_3__.X)(data);for(const object of iterable){numInstances+=Array.from(this.getText(object,objectInfo)).length,startIndices.push(numInstances)}this.setState({numInstances:numInstances,startIndices:startIndices})}updateLabelClusters(){const positions=[...this.state.labelPositions.values()];if(0===positions.length)return;const positionTree=static_kdtree__WEBPACK_IMPORTED_MODULE_1___default()(positions),clusters=new Map;for(const position of positions){const neighbors=[],visitor=id=>{neighbors.push(id)};positionTree.rnn(position,this.props.mergeRadius??10,visitor);const text=this.state.positionToText.get(position);if(!lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(text)){neighbors.sort();for(const id of neighbors){const text=this.state.positionToText.get(positions[id]);if(lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(text))continue;const cluster=clusters.get(position)??[];clusters.set(position,[...cluster,...text])}}}this.setState({clusters:clusters}),positionTree.dispose()}getText(object,objectInfo){const{getText:getText,mergeLabels:mergeLabels,getClusterText:getClusterText}=this.props,text=getText(object,objectInfo);if(!mergeLabels)return text;const position=this.state.labelPositions.get(text);if(lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(position))return text;const cluster=this.state.clusters.get(position);return lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(cluster)?text:text===cluster[0]?getClusterText(cluster):""}getBorderColor(object,objectInfo){const{getText:getText,getBorderColor:getBorderColor,mergeLabels:mergeLabels}=this.props,text=getText(object,objectInfo),borderColor="function"==typeof getBorderColor?getBorderColor(object,objectInfo):getBorderColor;if(!mergeLabels)return borderColor;const position=this.state.labelPositions.get(text);if(lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(position))return[255,100,100,255];const cluster=this.state.clusters.get(position);return lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(cluster)?[255,100,100,255]:cluster[0]===text?borderColor:[borderColor[0],borderColor[1],borderColor[2],0]}getColor(object,objectInfo){const{getText:getText,getColor:getColor,mergeLabels:mergeLabels}=this.props,text=getText(object,objectInfo),color="function"==typeof getColor?getColor(object,objectInfo):getColor;if(!mergeLabels)return color;const position=this.state.labelPositions.get(text);if(lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(position))return[255,100,100,255];const cluster=this.state.clusters.get(position);return lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(cluster)?[255,100,100,255]:cluster[0]===text?color:[0,0,0,0]}getBackgroundColor(object,objectInfo){const{getText:getText,getBackgroundColor:getBackgroundColor,mergeLabels:mergeLabels}=this.props,text=getText(object,objectInfo),backgroundColor="function"==typeof getBackgroundColor?getBackgroundColor(object,objectInfo):getBackgroundColor;if(!mergeLabels)return backgroundColor;const position=this.state.labelPositions.get(text);if(lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(position))return[255,100,100,255];const cluster=this.state.clusters.get(position);return lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(cluster)?[0,0,0,0]:cluster[0]===text?backgroundColor:[backgroundColor[0],backgroundColor[1],backgroundColor[2],0]}}},"./packages/subsurface-viewer/src/layers/wells/layers/wellLabelLayer.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{$:function(){return LabelOrientation},U:function(){return WellLabelLayer}});var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/lodash.js"),lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__),math_gl__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@math.gl/core/dist/classes/vector3.js"),math_gl__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@math.gl/core/dist/classes/vector2.js"),_deck_gl_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@deck.gl/core/dist/viewports/orbit-viewport.js"),_utils_trajectory__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/subsurface-viewer/src/layers/wells/utils/trajectory.ts"),_mergedTextLayer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/subsurface-viewer/src/layers/wells/layers/mergedTextLayer.ts"),_extensions_fixed_size_extension__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/subsurface-viewer/src/extensions/fixed-size-extension.ts");let LabelOrientation=function(LabelOrientation){return LabelOrientation.HORIZONTAL="horizontal",LabelOrientation.TANGENT="tangent",LabelOrientation}({});const DEFAULT_PROPS={id:"well-label-layer",autoPosition:!1,getPositionAlongPath:0,getText:d=>d.properties.name,getAlignmentBaseline:"bottom",getSize:10,getColor:[0,0,0,255],zIncreasingDownwards:!0,orientation:LabelOrientation.HORIZONTAL,backgroundPadding:[3,1,3,1],getBorderColor:[0,0,0,255],getBorderWidth:1,pickable:!0,transitions:{getPosition:{duration:100,type:"interpolation"},getColor:{duration:100,type:"interpolation",enter:([r,g,b])=>[r,g,b,0],easing:t=>lodash__WEBPACK_IMPORTED_MODULE_0___default().floor(t)},getBorderColor:{duration:1,type:"interpolation",enter:([r,g,b])=>[r,g,b,0],easing:t=>lodash__WEBPACK_IMPORTED_MODULE_0___default().floor(t)},getBackgroundColor:{duration:1,type:"spring",enter:([r,g,b])=>[r,g,b,0]}},extensions:[new _extensions_fixed_size_extension__WEBPACK_IMPORTED_MODULE_3__.$]};class WellLabelLayer extends _mergedTextLayer__WEBPACK_IMPORTED_MODULE_2__.x{getSubLayerProps(sublayerProps){const angleUpdateTriggers=sublayerProps?.updateTriggers?.getAngle??[],positionUpdateTriggers=sublayerProps?.updateTriggers?.getPosition??[],newProps={...sublayerProps,getPosition:d=>this.getAnnotationPosition(d,this.props.getPositionAlongPath),getAngle:d=>this.getLabelAngle(d),updateTriggers:{...sublayerProps?.updateTriggers,getAngle:[...angleUpdateTriggers,this.context.viewport.constructor===_deck_gl_core__WEBPACK_IMPORTED_MODULE_5__.A?this.context.viewport.cameraPosition:null,this.props.orientation,this.props.getPositionAlongPath],getPosition:[...positionUpdateTriggers,this.context.viewport.cameraPosition,this.props.getPositionAlongPath]}};return super.getSubLayerProps(newProps)}shouldUpdateState(params){return!(!params.changeFlags.viewportChanged||!params.props.autoPosition&&"tangent"!==params.props.orientation)||super.shouldUpdateState(params)}updateState(params){params.props.autoPosition&&params.changeFlags.viewportChanged&&(params.changeFlags.dataChanged="autoPosition"),super.updateState(params)}getLabelAngle(well){if("horizontal"===this.props.orientation)return 0;const position=Number(this.props.getPositionAlongPath);lodash__WEBPACK_IMPORTED_MODULE_0___default().clamp(position,0,1);return this.getVectorAlongTrajectory(position,well)[0]}getAnnotationPosition(well_data,annotationPosition){let fraction=Number(annotationPosition);return"function"==typeof annotationPosition&&(fraction=annotationPosition(well_data)),fraction=lodash__WEBPACK_IMPORTED_MODULE_0___default().clamp(fraction,0,1),this.getVectorAlongTrajectory(fraction,well_data)[1]}getVectorAlongTrajectory(fraction,wellData){if(!wellData)return[0,[0,0,0]];const trajectory=(0,_utils_trajectory__WEBPACK_IMPORTED_MODULE_1__._v)(wellData,void 0);if(lodash__WEBPACK_IMPORTED_MODULE_0___default().isUndefined(trajectory)||trajectory.length<2)return[0,[0,0,0]];const{width:width,height:height}=this.context.viewport,candidateFractions=[.5,.25,.75,.125,.87,.37,.62],cumulativeDistance=(well_xyz=>{const cumulativeDistance=[0];for(let i=1;i<well_xyz.length;i++){const p1=well_xyz[i-1],p2=well_xyz[i];if(!p1||!p2)continue;const v0=new math_gl__WEBPACK_IMPORTED_MODULE_4__.P(p1),v1=new math_gl__WEBPACK_IMPORTED_MODULE_4__.P(p2),distance=v0.distance(v1);cumulativeDistance.push(cumulativeDistance[i-1]+distance)}return cumulativeDistance})(trajectory),zSign=this.props.zIncreasingDownwards?new math_gl__WEBPACK_IMPORTED_MODULE_4__.P(1,1,-1):new math_gl__WEBPACK_IMPORTED_MODULE_4__.P(1,1,1);for(;0!=candidateFractions.length;){const targetDistance=cumulativeDistance[cumulativeDistance.length-1]*fraction;let targetIndex=0;for(let i=0;i<cumulativeDistance.length-1;i++)if(!(cumulativeDistance[i+1]<targetDistance)){targetIndex=i;break}const segmentBegin=new math_gl__WEBPACK_IMPORTED_MODULE_4__.P([...trajectory[targetIndex]]),segmentEnd=new math_gl__WEBPACK_IMPORTED_MODULE_4__.P([...trajectory[targetIndex+1]]);segmentBegin.multiply(zSign),segmentEnd.multiply(zSign);const distanceAlongTrajectory1=cumulativeDistance[targetIndex],fractionOnLine=(targetDistance-distanceAlongTrajectory1)/(cumulativeDistance[targetIndex+1]-distanceAlongTrajectory1),labelPosition=new math_gl__WEBPACK_IMPORTED_MODULE_4__.P(segmentBegin).lerp(segmentEnd,fractionOnLine);if(this.props.autoPosition){const ps=this.project(labelPosition);if(ps[0]<0||ps[0]>width||ps[1]<0||ps[1]>height){fraction=candidateFractions.shift()??0;continue}}const p1=this.project(segmentBegin),p2=this.project(segmentEnd),v=new math_gl__WEBPACK_IMPORTED_MODULE_6__.I(p2[0]-p1[0],-(p2[1]-p1[1]));v.normalize();const deg=Math.atan2(v[1],v[0])*(180/Math.PI);let a=deg;return deg>90?a=deg-180:deg<-90&&(a=deg+180),[a,labelPosition.toArray()]}return[0,trajectory[0]]}getPickingInfo({info:info}){const name=info.object?.properties?.name??"",pos=this.state.labelPositions.get(name),names=this.state.clusters.get(pos);return info.object={...info.object,wellLabels:names},info}}WellLabelLayer.defaultProps=DEFAULT_PROPS,WellLabelLayer.layerName="WellLabelLayer"},"./packages/subsurface-viewer/src/layers/wells/utils/features.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{YC:function(){return getSize},pj:function(){return LINE},wu:function(){return getWellHeadPosition},yt:function(){return DEFAULT_LINE_WIDTH},zh:function(){return POINT}});var _utils_layerTools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/subsurface-viewer/src/layers/utils/layerTools.ts");const LINE="line",POINT="point",DEFAULT_POINT_SIZE=8,DEFAULT_LINE_WIDTH=5;function getSize(type,accessor,offset=0){if("function"==typeof accessor)return(object,objectInfo)=>{const width=(0,_utils_layerTools__WEBPACK_IMPORTED_MODULE_0__.eM)(accessor,object,objectInfo)??0;return 0===width?0:width+offset};if("number"==typeof accessor){if(accessor<=0)return 0;if(accessor>0)return accessor+offset}return type==LINE?DEFAULT_LINE_WIDTH+offset:type==POINT?DEFAULT_POINT_SIZE+offset:(console.warn(`Unrecognized feature type: ${type}`),0)}function getWellHeadPosition(well_object){return function getPointGeometry(well_object){return well_object.geometry.geometries.find((item=>"Point"===item.type))}(well_object)?.coordinates}},"./packages/subsurface-viewer/src/layers/wells/utils/trajectory.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{JW:function(){return getMdsInRange},Qq:function(){return getMd},ZD:function(){return getTvd},_v:function(){return getTrajectory},c3:function(){return getSegmentIndex},oU:function(){return getColor}});var mathjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/mathjs/lib/esm/entry/pureFunctionsAny.generated.js"),_utils_measurement__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/subsurface-viewer/src/utils/measurement.ts"),_features__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/subsurface-viewer/src/layers/wells/utils/features.ts");function getColor(accessor){return Array.isArray(accessor)?accessor:(object,objectInfo)=>{if("function"==typeof accessor){const color=accessor(object,objectInfo);if(color)return color}return object.properties?.color}}function getTrajectory(well_object,color_accessor){return function isTrajectoryTransparent(well_object,color_accessor){let alpha;const accessor=getColor(color_accessor);return alpha="function"==typeof accessor?accessor(well_object)?.[3]:accessor?.[3],0===alpha}(well_object,color_accessor)?void 0:function getLineStringGeometry(well_object){return well_object.geometry.geometries.find((item=>"LineString"===item.type))}(well_object)?.coordinates}function getMdsInRange(mdArray,mdStart,mdEnd){const mdSection=[];mdSection.push(mdStart);for(let index=0;index<mdArray.length;index++){const md=mdArray[index];if(!(md<=mdStart)){if(md>=mdEnd)break;mdSection.push(md)}}return mdSection.push(mdEnd),mdSection}function interpolateDataOnTrajectory(coord,data,trajectory){if(data.length<=1||data.length!=trajectory.length)return null;const index0=getSegmentIndex(coord,trajectory),index1=index0+1,data0=data[index0],data1=data[index1],survey0=trajectory[index0],survey1=trajectory[index1];index1===trajectory.length-1&&(0,_utils_measurement__WEBPACK_IMPORTED_MODULE_0__.o6)(coord,[survey0,survey1])&&(coord=survey1);const dv=(0,mathjs__WEBPACK_IMPORTED_MODULE_1__.IoC)(survey0,survey1);if(0===dv)return null;const v0=(0,mathjs__WEBPACK_IMPORTED_MODULE_1__.ReH)(coord,survey0),v1=(0,mathjs__WEBPACK_IMPORTED_MODULE_1__.ReH)(survey1,survey0),scalar_projection=(0,mathjs__WEBPACK_IMPORTED_MODULE_1__.Omf)(v0,v1)/(dv*dv);return data0*(1-scalar_projection)+data1*scalar_projection}function getMd(coord,feature,accessor){if(!feature.properties?.md?.[0]||!feature.geometry)return null;const measured_depths=feature.properties.md[0],trajectory3D=getTrajectory(feature,accessor);if(null==trajectory3D)return null;let trajectory;if(2==coord.length){trajectory=trajectory3D.map((v=>v.slice(0,2)))}else trajectory=trajectory3D;return interpolateDataOnTrajectory(coord,measured_depths,trajectory)}function getTvd(coord,feature,accessor){const trajectory3D=getTrajectory(feature,accessor);if(null==trajectory3D||trajectory3D?.length<=1){const wellhead_xyz=(0,_features__WEBPACK_IMPORTED_MODULE_2__.wu)(feature);return wellhead_xyz?.[2]??null}let trajectory;if(2==coord.length){const trajectory2D=trajectory3D?.map((v=>v.slice(0,2)));trajectory=trajectory2D}else trajectory=trajectory3D;return interpolateDataOnTrajectory(coord,trajectory3D.map((v=>v[2])),trajectory)}function getSegmentIndex(coord,path){let min_d=Number.MAX_VALUE,segment_index=0;for(let i=0;i<path?.length-1;i++){const d=(0,_utils_measurement__WEBPACK_IMPORTED_MODULE_0__.Sl)(path[i],path[i+1],coord);d>min_d||(segment_index=i,min_d=d)}return segment_index}},"./packages/subsurface-viewer/src/utils/BoundingBox3D.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{$D:function(){return boxUnion},Hg:function(){return boxCenter},Im:function(){return isEmpty},xt:function(){return computeBoundingBox}});const boxUnion=(box1,box2,defaultBox=[0,0,0,1,1,1])=>{if(void 0===box1)return box2??defaultBox;if(void 0===box2)return box1??defaultBox;return[Math.min(box1[0],box2[0]),Math.min(box1[1],box2[1]),Math.min(box1[2],box2[2]),Math.max(box1[3],box2[3]),Math.max(box1[4],box2[4]),Math.max(box1[5],box2[5])]},boxCenter=box=>{const xmin=box[0],ymin=box[1],zmin=box[2];return[xmin+.5*(box[3]-xmin),ymin+.5*(box[4]-ymin),zmin+.5*(box[5]-zmin)]},isEmpty=box=>{if(null==box)return!0;const xmin=box[0],ymin=box[1],zmin=box[2],xmax=box[3],ymax=box[4],zmax=box[5];return!(xmax>xmin&&ymax>ymin&&zmax!=zmin)};function computeBoundingBox(dataArray){const length=dataArray.length;let minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY,minZ=Number.POSITIVE_INFINITY,maxX=Number.NEGATIVE_INFINITY,maxY=Number.NEGATIVE_INFINITY,maxZ=Number.NEGATIVE_INFINITY;for(let i=0;i<length;i+=3){const x=dataArray[i],y=dataArray[i+1],z=dataArray[i+2];minX=x<minX?x:minX,minY=y<minY?y:minY,minZ=z<minZ?z:minZ,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,maxZ=z>maxZ?z:maxZ}return[minX,minY,minZ,maxX,maxY,maxZ]}},"./packages/subsurface-viewer/src/utils/measurement.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Bw:function(){return length},Sl:function(){return distToSegmentSquared},Wc:function(){return area},o6:function(){return isPointAwayFromLineEnd}});var mathjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/mathjs/lib/esm/entry/pureFunctionsAny.generated.js"),_turf_meta__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@turf/meta/main.es.js");function length(geojson){return(0,_turf_meta__WEBPACK_IMPORTED_MODULE_0__.OQ)(geojson,(function(previousValue,segment){if(void 0===segment||void 0===previousValue)return 0;const coords=segment.geometry.coordinates;return previousValue+function distance(from,to){const[x1,y1,z1]=from,[x2,y2,z2]=to;let a=Math.pow(x1-x2,2)+Math.pow(y1-y2,2);z1&&z2&&(a+=Math.pow(z2-z1,2));return Math.sqrt(a)}(coords[0],coords[1])}),0)}function area(geojson){return(0,_turf_meta__WEBPACK_IMPORTED_MODULE_0__.jE)(geojson,(function(value,geom){return value+function calculateArea(geom){const coords=geom.coordinates[0];let total=0;for(let i=0,l=coords.length;i<l;i++){total+=coords[i][0]*coords[i==coords.length-1?0:i+1][1]*.5,total-=coords[i==coords.length-1?0:i+1][0]*coords[i][1]*.5}return Math.abs(total)}(geom)}),0)}function squared_distance(a,b){const dx=a[0]-b[0],dy=a[1]-b[1];return dx*dx+dy*dy}function distToSegmentSquared(v,w,p){const l2=squared_distance(v,w);if(0==l2)return squared_distance(p,v);let t=((p[0]-v[0])*(w[0]-v[0])+(p[1]-v[1])*(w[1]-v[1]))/l2;return t=Math.max(0,Math.min(1,t)),squared_distance(p,[v[0]+t*(w[0]-v[0]),v[1]+t*(w[1]-v[1])])}function isPointAwayFromLineEnd(point,line){const ab=(0,mathjs__WEBPACK_IMPORTED_MODULE_1__.ReH)(line[1],line[0]),cb=(0,mathjs__WEBPACK_IMPORTED_MODULE_1__.ReH)(line[1],point);return(0,mathjs__WEBPACK_IMPORTED_MODULE_1__.Omf)(ab,cb)<0}},"./packages/subsurface-viewer/src/viewports/sectionViewport.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{c:function(){return SectionViewport}});var _deck_gl_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@deck.gl/core/dist/viewports/orthographic-viewport.js");class SectionViewport extends _deck_gl_core__WEBPACK_IMPORTED_MODULE_0__.A{constructor(props){super(props)}}},"?d4c0":function(){}}]);